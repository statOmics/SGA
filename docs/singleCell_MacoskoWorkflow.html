<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Koen Van den Berge" />

<meta name="date" content="2020-11-16" />

<title>scRNA-seq workflow: Macosko et al.</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SGA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">---- INTRODUCTION ----</li>
    <li>
      <a href="intro.html">1.1 Position</a>
    </li>
    <li>
      <a href="recapGeneralLinearModel.html">1.2 Recap linear model</a>
    </li>
    <li class="dropdown-header">---- MODULE I PROTEOMICS ----</li>
    <li>
      <a href="./figs/part1_ms_basics.pdf">1.1 MS Basics</a>
    </li>
    <li>
      <a href="./figs/part1_ms_basics.pdf">1.2 Identification</a>
    </li>
    <li>
      <a href="TargetDecoy.html">2.1 Identification - FDR - QC</a>
    </li>
    <li>
      <a href="pda_quantification_preprocessing.html">2.2.1 Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_robustSummarisation_peptideModels.html">2.2.2 Wrap-up Preprocessing - Peptide-Level-Models</a>
    </li>
    <li>
      <a href="pda_quantification_inference.html">2.3.1 Quantification - Differential Abundance Analysis</a>
    </li>
    <li>
      <a href="pda_blocking_wrapup.html">2.3.2. Wrap-up DA - Blocking</a>
    </li>
    <li>
      <a href="pda_technicalDetails.html">2.3.3. Technical Details</a>
    </li>
    <li class="dropdown-header">---- MODULE II RNA-seq ----</li>
    <li>
      <a href="sequencing_intro.html">1.  Introduction to RNA-seq</a>
    </li>
    <li>
      <a href="sequencing_countData.html">2.  Working with count data and GLMs</a>
    </li>
    <li>
      <a href="sequencing_technicalDE.html">3.  Technical Details</a>
    </li>
    <li>
      <a href="https://www.biorxiv.org/content/10.1101/2023.06.29.547014v2">4. Transcript-level DE and Usage</a>
    </li>
    <li>
      <a href="sequencing_singleCell.html">6. Intro to scRNA-seq</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">---- INTRODUCTION ----</li>
    <li>
      <a href="multipleRegression_KPNA2.html">1 Intro KPNA2</a>
    </li>
    <li class="dropdown-header">---- MODULE I PROTEOMICS ----</li>
    <li>
      <a href="https://www.compomics.com/bioinformatics-for-proteomics/">1. Bioinformatics for Proteomics</a>
    </li>
    <li>
      <a href="TargetDecoyTutorial.html">2.1. Target Decoy QC</a>
    </li>
    <li>
      <a href="pda_tutorialPreprocessing.html">2.2. Quantification - Preprocessing</a>
    </li>
    <li>
      <a href="pda_tutorialDesign.html">2.3. Quantification - Design</a>
    </li>
    <li>
      <a href="sequencingTutorial1_mapping.html">1. Read mapping</a>
    </li>
    <li>
      <a href="sequencingTutorial2_DE.html">2. Working with Count Data</a>
    </li>
    <li>
      <a href="sequencingTutorial3_DE.html">4. Transcript-level DE and Usage</a>
    </li>
    <li>
      <a href="scRNA-seq-Tutorial.html">6. Tutorial scRNA-seq</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">scRNA-seq workflow: Macosko et al.</h1>
<h4 class="author">Koen Van den Berge</h4>
<h4 class="date">11/16/2020</h4>

</div>


<div id="import-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Import data</h1>
<p>The <code>scRNAseq</code> package provides convenient access to
several datasets. See the <a
href="http://bioconductor.org/packages/release/data/experiment/html/scRNAseq.html">package
Bioconductor page</a> for more information.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install BiocManager package if not installed yet.</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># BiocManager is the package installer for Bioconductor software.</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># install packages if not yet installed.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SingleCellExperiment&quot;</span>, <span class="st">&quot;DropletUtils&quot;</span>, <span class="st">&quot;scRNAseq&quot;</span>, <span class="st">&quot;scater&quot;</span>, <span class="st">&quot;scuttle&quot;</span>, <span class="st">&quot;scran&quot;</span>, <span class="st">&quot;BiocSingular&quot;</span>, <span class="st">&quot;scDblFinder&quot;</span>, <span class="st">&quot;glmpca&quot;</span>, <span class="st">&quot;uwot&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>notInstalled <span class="ot">&lt;-</span> pkgs[<span class="sc">!</span>pkgs <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[,<span class="dv">1</span>]]</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(notInstalled) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  BiocManager<span class="sc">::</span><span class="fu">install</span>(notInstalled)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>}</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Code below might ask you to create an ExperimentHub directory. </span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># Type &#39;yes&#39; and hit Enter, to allow this.</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(scRNAseq))</span></code></pre></div>
<pre><code>## Warning: package &#39;SingleCellExperiment&#39; was built under R version 4.4.2</code></pre>
<pre><code>## Warning: package &#39;GenomeInfoDb&#39; was built under R version 4.4.2</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">MacoskoRetinaData</span>()</span></code></pre></div>
</div>
<div id="a-singlecellexperiment-object" class="section level1"
number="2">
<h1><span class="header-section-number">2</span> A
<code>SingleCellExperiment</code> object</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 24658 49300 
## metadata(0):
## assays(1): counts
## rownames(24658): KITL TMTC3 ... 1110059M19RIK GM20861
## rowData names(0):
## colnames(49300): r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA ... p1_TAACGCGCTCCT
##   p1_ATTCTTGTTCTT
## colData names(1): cluster
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<div id="accessing-data-from-a-singlecellexperiment-object"
class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Accessing data from a
<code>SingleCellExperiment</code> object</h2>
<p>Please see <a
href="http://bioconductor.org/books/release/OSCA/data-infrastructure.html">Figure
4.1 in OSCA</a> for an overview of a <code>SingleCellExperiment</code>
object.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Data: assays</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">assays</span>(sce)</span></code></pre></div>
<pre><code>## List of length 1
## names(1): counts</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">assays</span>(sce)<span class="sc">$</span>counts[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## 5 x 5 sparse Matrix of class &quot;dgCMatrix&quot;
##               r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA r1_GCGCAACTGCTC r1_GATTGGGAGGCA
## KITL                        .               .               1               .
## TMTC3                       3               .               .               .
## CEP290                      1               3               .               2
## 4930430F08RIK               2               1               2               .
## 1700017N19RIK               .               .               .               .
##               r1_CCTCCTAGTTGG
## KITL                        .
## TMTC3                       2
## CEP290                      1
## 4930430F08RIK               1
## 1700017N19RIK               .</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Feature metadata: rowData</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">rowData</span>(sce) <span class="co"># empty for now</span></span></code></pre></div>
<pre><code>## DataFrame with 24658 rows and 0 columns</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Cell metadata: colData</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">colData</span>(sce)</span></code></pre></div>
<pre><code>## DataFrame with 49300 rows and 1 column
##                   cluster
##                 &lt;integer&gt;
## r1_GGCCGCAGTCCG         2
## r1_CTTGTGCGGGAA         2
## r1_GCGCAACTGCTC         2
## r1_GATTGGGAGGCA         2
## r1_CCTCCTAGTTGG        NA
## ...                   ...
## p1_TCAAAAGCCGGG        24
## p1_ATTAAGTTCCAA        34
## p1_CTGTCTGAGACC         2
## p1_TAACGCGCTCCT        24
## p1_ATTCTTGTTCTT        24</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Reduced dimensions: reducedDims</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">reducedDims</span>(sce) <span class="co"># empty for now</span></span></code></pre></div>
<pre><code>## List of length 0
## names(0):</code></pre>
</div>
<div id="creating-a-new-singlecellexperiment-object"
class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Creating a new
<code>SingleCellExperiment</code> object</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>sceNew <span class="ot">&lt;-</span> <span class="fu">SingleCellExperiment</span>(<span class="at">assays =</span> <span class="fu">list</span>(<span class="at">counts =</span> <span class="fu">assays</span>(sce)<span class="sc">$</span>counts))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>sceNew</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 24658 49300 
## metadata(0):
## assays(1): counts
## rownames(24658): KITL TMTC3 ... 1110059M19RIK GM20861
## rowData names(0):
## colnames(49300): r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA ... p1_TAACGCGCTCCT
##   p1_ATTCTTGTTCTT
## colData names(0):
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">rm</span>(sceNew)</span></code></pre></div>
</div>
<div id="storing-metadata-in-a-singlecellexperiment-object"
class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Storing (meta)data in
a <code>SingleCellExperiment</code> object</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>fakeGeneNames <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;gene&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sce))</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">rowData</span>(sce)<span class="sc">$</span>fakeName <span class="ot">&lt;-</span> fakeGeneNames</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rowData</span>(sce))</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 1 column
##                  fakeName
##               &lt;character&gt;
## KITL                gene1
## TMTC3               gene2
## CEP290              gene3
## 4930430F08RIK       gene4
## 1700017N19RIK       gene5
## MGAT4C              gene6</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Remove again by setting to NULL</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">rowData</span>(sce)<span class="sc">$</span>fakeName <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="fu">assays</span>(sce)<span class="sc">$</span>logCounts <span class="ot">&lt;-</span> <span class="fu">log1p</span>(<span class="fu">assays</span>(sce)<span class="sc">$</span>counts)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="fu">assays</span>(sce)</span></code></pre></div>
<pre><code>## List of length 2
## names(2): counts logCounts</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">assays</span>(sce)<span class="sc">$</span>logCounts[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## 5 x 5 sparse Matrix of class &quot;dgCMatrix&quot;
##               r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA r1_GCGCAACTGCTC r1_GATTGGGAGGCA
## KITL                .               .               0.6931472        .       
## TMTC3               1.3862944       .               .                .       
## CEP290              0.6931472       1.3862944       .                1.098612
## 4930430F08RIK       1.0986123       0.6931472       1.0986123        .       
## 1700017N19RIK       .               .               .                .       
##               r1_CCTCCTAGTTGG
## KITL                .        
## TMTC3               1.0986123
## CEP290              0.6931472
## 4930430F08RIK       0.6931472
## 1700017N19RIK       .</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">assays</span>(sce)<span class="sc">$</span>logCounts <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
</div>
<div id="filtering-non-informative-genes" class="section level1"
number="3">
<h1><span class="header-section-number">3</span> Filtering
non-informative genes</h1>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">assays</span>(sce)<span class="sc">$</span>counts <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">table</span>(keep)</span></code></pre></div>
<pre><code>## keep
## FALSE  TRUE 
##  6771 17887</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[keep,]</span></code></pre></div>
</div>
<div id="quality-control" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Quality control</h1>
<div id="calculate-qc-variables" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Calculate QC
variables</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">library</span>(scater)</span></code></pre></div>
<pre><code>## Loading required package: scuttle</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>is.mito <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">&quot;^MT-&quot;</span>, <span class="fu">rownames</span>(sce))</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">sum</span>(is.mito) <span class="co"># 28 mitochondrial genes</span></span></code></pre></div>
<pre><code>## [1] 28</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">perCellQCMetrics</span>(sce, <span class="at">subsets=</span><span class="fu">list</span>(<span class="at">Mito=</span>is.mito))</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="do">## add the QC variables to sce object</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="fu">colData</span>(sce) <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">colData</span>(sce), df)</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co"># the QC variables have now been added to the colData of our SCE object.</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="fu">colData</span>(sce)</span></code></pre></div>
<pre><code>## DataFrame with 49300 rows and 7 columns
##                   cluster       sum  detected subsets_Mito_sum
##                 &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;        &lt;numeric&gt;
## r1_GGCCGCAGTCCG         2     37478      7235              427
## r1_CTTGTGCGGGAA         2     32034      6921              503
## r1_GCGCAACTGCTC         2     28140      6390              460
## r1_GATTGGGAGGCA         2     20352      5727              326
## r1_CCTCCTAGTTGG        NA     19550      5769              264
## ...                   ...       ...       ...              ...
## p1_TCAAAAGCCGGG        24       817       537               13
## p1_ATTAAGTTCCAA        34       817       574               10
## p1_CTGTCTGAGACC         2       816       636               24
## p1_TAACGCGCTCCT        24       816       488               27
## p1_ATTCTTGTTCTT        24       816       484               16
##                 subsets_Mito_detected subsets_Mito_percent     total
##                             &lt;integer&gt;            &lt;numeric&gt; &lt;numeric&gt;
## r1_GGCCGCAGTCCG                    14              1.13934     37478
## r1_CTTGTGCGGGAA                    15              1.57021     32034
## r1_GCGCAACTGCTC                    13              1.63468     28140
## r1_GATTGGGAGGCA                    11              1.60181     20352
## r1_CCTCCTAGTTGG                     9              1.35038     19550
## ...                               ...                  ...       ...
## p1_TCAAAAGCCGGG                     4              1.59119       817
## p1_ATTAAGTTCCAA                     5              1.22399       817
## p1_CTGTCTGAGACC                     7              2.94118       816
## p1_TAACGCGCTCCT                     5              3.30882       816
## p1_ATTCTTGTTCTT                     4              1.96078       816</code></pre>
</div>
<div id="eda" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> EDA</h2>
<p>High-quality cells should have many features expressed, and a low
contribution of mitochondrial genes. Here, we see that several cells
have a very low number of expressed genes, and where most of the
molecules are derived from mitochondrial genes. This indicates likely
damaged cells, presumably because of loss of cytoplasmic RNA from
perforated cells, so we’d want to remove these for the downstream
analysis.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co"># Number of genes vs library size</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">y=</span><span class="st">&quot;detected&quot;</span>, <span class="at">colour_by=</span><span class="st">&quot;cluster&quot;</span>) </span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># Mitochondrial genes</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;detected&quot;</span>, <span class="at">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
</div>
<div id="qc-using-adaptive-thresholds" class="section level2"
number="4.3">
<h2><span class="header-section-number">4.3</span> QC using adaptive
thresholds</h2>
<p>Below, we remove cells that are outlying with respect to</p>
<ol style="list-style-type: decimal">
<li>A low sequencing depth (number of UMIs);</li>
<li>A low number of genes detected;</li>
<li>A high percentage of reads from mitochondrial genes.</li>
</ol>
<p>We remove a total of <span class="math inline">\(3423\)</span> cells,
most of which because of an outlyingly high percentage of reads from
mitochondrial genes.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>lowLib <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(df<span class="sc">$</span>sum, <span class="at">type=</span><span class="st">&quot;lower&quot;</span>, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>lowFeatures <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(df<span class="sc">$</span>detected, <span class="at">type=</span><span class="st">&quot;lower&quot;</span>, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>highMito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(df<span class="sc">$</span>subsets_Mito_percent, <span class="at">type=</span><span class="st">&quot;higher&quot;</span>)</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="fu">table</span>(lowLib)</span></code></pre></div>
<pre><code>## lowLib
## FALSE 
## 49300</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">table</span>(lowFeatures)</span></code></pre></div>
<pre><code>## lowFeatures
## FALSE  TRUE 
## 49287    13</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">table</span>(highMito)</span></code></pre></div>
<pre><code>## highMito
## FALSE  TRUE 
## 45890  3410</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>discardCells <span class="ot">&lt;-</span> (lowLib <span class="sc">|</span> lowFeatures <span class="sc">|</span> highMito)</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="fu">table</span>(discardCells)</span></code></pre></div>
<pre><code>## discardCells
## FALSE  TRUE 
## 45877  3423</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">colData</span>(sce)<span class="sc">$</span>discardCells <span class="ot">&lt;-</span> discardCells</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="co"># visualize cells to be removed</span></span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a><span class="fu">plotColData</span>(sce, <span class="at">x =</span> <span class="st">&quot;detected&quot;</span>, <span class="at">y=</span><span class="st">&quot;subsets_Mito_percent&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;discardCells&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="identifying-and-removing-empty-droplets" class="section level2"
number="4.4">
<h2><span class="header-section-number">4.4</span> Identifying and
removing empty droplets</h2>
<p>Note that the removal of cells with low sequencing depth using the
adaptive threshold procedure above is a way of removing empty droplets.
Other approaches are possible, e.g., removing cells by statistical
testing using <code>emtpyDrops</code>. This does require us to specify a
lower bound on the total number of UMIs, below which all cells are
considered to correspond to empty droplets. This lower bound may not be
trivial to derive, but the <code>barcodeRanks</code> function can be
useful to identify an elbow/knee point.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">library</span>(DropletUtils)</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>bcrank <span class="ot">&lt;-</span> <span class="fu">barcodeRanks</span>(<span class="fu">counts</span>(sce))</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="co"># Only showing unique points for plotting speed.</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>uniq <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(bcrank<span class="sc">$</span>rank)</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="fu">plot</span>(bcrank<span class="sc">$</span>rank[uniq], bcrank<span class="sc">$</span>total[uniq], <span class="at">log=</span><span class="st">&quot;xy&quot;</span>,</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Rank&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Total UMI count&quot;</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">metadata</span>(bcrank)<span class="sc">$</span>inflection, <span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">metadata</span>(bcrank)<span class="sc">$</span>knee, <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">350</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># picked visually myself</span></span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Inflection&quot;</span>, <span class="st">&quot;Knee&quot;</span>, <span class="st">&quot;Empirical knee point&quot;</span>), </span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>limit <span class="ot">&lt;-</span> <span class="dv">350</span>   </span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>all.out <span class="ot">&lt;-</span> <span class="fu">emptyDrops</span>(<span class="fu">counts</span>(sce), <span class="at">lower=</span>limit, <span class="at">test.ambient=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning in smooth.spline(x[new.keep], y[new.keep], df = df, ...): not using
## invalid df; must have 1 &lt; df &lt;= n := #{unique x} = 9</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># p-values for cells with total UMI count under the lower bound.</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">hist</span>(all.out<span class="sc">$</span>PValue[all.out<span class="sc">$</span>Total <span class="sc">&lt;=</span> limit <span class="sc">&amp;</span> all.out<span class="sc">$</span>Total <span class="sc">&gt;</span> <span class="dv">0</span>],</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;P-value&quot;</span>, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># but note that it would remove a very high number of cells</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(all.out<span class="sc">$</span>FDR <span class="sc">&lt;=</span> <span class="fl">0.001</span>))</span></code></pre></div>
<pre><code>## [1] 25088</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># so we stick to the more lenient adaptive filtering strategy</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="co"># remove cells identified using adaptive thresholds</span></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[, <span class="sc">!</span><span class="fu">colData</span>(sce)<span class="sc">$</span>discardCells]</span></code></pre></div>
</div>
<div id="identifying-and-removing-doublets" class="section level2"
number="4.5">
<h2><span class="header-section-number">4.5</span> Identifying and
removing doublets</h2>
<p>We will use <a
href="https://bioconductor.org/packages/3.14/bioc/html/scDblFinder.html">scDblFinder</a>
to detect doublet cells.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="do">## perform doublet detection</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a><span class="fu">library</span>(scDblFinder)</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">211103</span>)</span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a><span class="fu">colData</span>(sce)<span class="sc">$</span>cell.id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">colData</span>(sce))</span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a>sampleID <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">strsplit</span>(<span class="fu">colData</span>(sce)<span class="sc">$</span>cell.id, <span class="at">split=</span><span class="st">&quot;_&quot;</span>), <span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>))</span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a><span class="fu">table</span>(sampleID)</span></code></pre></div>
<pre><code>## sampleID
##   p1   r1   r2   r3   r4   r5   r6 
## 3942 5953 8414 5319 7015 7487 7747</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">scDblFinder</span>(sce,</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>                 <span class="at">samples =</span> <span class="fu">factor</span>(sampleID))</span></code></pre></div>
<pre><code>##   |                                                                              |                                                                      |   0%  |                                                                              |==========                                                            |  14%  |                                                                              |====================                                                  |  29%  |                                                                              |==============================                                        |  43%  |                                                                              |========================================                              |  57%  |                                                                              |==================================================                    |  71%  |                                                                              |============================================================          |  86%  |                                                                              |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">table</span>(sce<span class="sc">$</span>scDblFinder.class)</span></code></pre></div>
<pre><code>## 
## singlet doublet 
##   37092    8785</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="do">## visualize these scores</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="do">## explore doublet score wrt original cluster labels</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">log1p</span>(sce<span class="sc">$</span>scDblFinder.score) <span class="sc">~</span> <span class="fu">factor</span>(<span class="fu">colData</span>(sce)<span class="sc">$</span>cluster, <span class="at">exclude=</span><span class="cn">NULL</span>))</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(sce<span class="sc">$</span>scDblFinder.class, sce<span class="sc">$</span>cluster, </span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>       <span class="at">exclude=</span><span class="cn">NULL</span>)</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>##          
##               1     2     3     4     5     6     7     8     9    10    11
##   singlet   212   363   245    63    60   150   231   137   278   153   161
##   doublet     3    14    30     9    14    55    86    12    59    36    46
##          
##              12    13    14    15    16    17    18    19    20    21    22
##   singlet   192    42    75    42   187   286    61   100   306   166   184
##   doublet    62     8    33    30    64    85    19    25    76    81    77
##          
##              23    24    25    26    27    28    29    30    31    32    33
##   singlet   195 22607  1138  1864   424   301   431   469   381   259   612
##   doublet    64  4336   635   297   205   180   150   161   121    59   201
##          
##              34    35    36    37    38    39  &lt;NA&gt;
##   singlet  1386    36    37   230    56    61  2911
##   doublet   178     7     8    10     3     5  1241</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">t</span>(tab) <span class="sc">/</span> <span class="fu">colSums</span>(tab))</span></code></pre></div>
<pre><code>##          
##                    1          2          3          4          5          6
##   singlet 0.98604651 0.96286472 0.89090909 0.87500000 0.81081081 0.73170732
##   doublet 0.01395349 0.03713528 0.10909091 0.12500000 0.18918919 0.26829268
##          
##                    7          8          9         10         11         12
##   singlet 0.72870662 0.91946309 0.82492582 0.80952381 0.77777778 0.75590551
##   doublet 0.27129338 0.08053691 0.17507418 0.19047619 0.22222222 0.24409449
##          
##                   13         14         15         16         17         18
##   singlet 0.84000000 0.69444444 0.58333333 0.74501992 0.77088949 0.76250000
##   doublet 0.16000000 0.30555556 0.41666667 0.25498008 0.22911051 0.23750000
##          
##                   19         20         21         22         23         24
##   singlet 0.80000000 0.80104712 0.67206478 0.70498084 0.75289575 0.83906766
##   doublet 0.20000000 0.19895288 0.32793522 0.29501916 0.24710425 0.16093234
##          
##                   25         26         27         28         29         30
##   singlet 0.64184997 0.86256363 0.67408585 0.62577963 0.74182444 0.74444444
##   doublet 0.35815003 0.13743637 0.32591415 0.37422037 0.25817556 0.25555556
##          
##                   31         32         33         34         35         36
##   singlet 0.75896414 0.81446541 0.75276753 0.88618926 0.83720930 0.82222222
##   doublet 0.24103586 0.18553459 0.24723247 0.11381074 0.16279070 0.17777778
##          
##                   37         38         39       &lt;NA&gt;
##   singlet 0.95833333 0.94915254 0.92424242 0.70110790
##   doublet 0.04166667 0.05084746 0.07575758 0.29889210</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(<span class="fu">t</span>(tab) <span class="sc">/</span> <span class="fu">colSums</span>(tab))[<span class="dv">2</span>,],</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Cluster&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Fraction of doublets&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="co"># remove doublets</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>sce <span class="ot">&lt;-</span> sce[,<span class="sc">!</span>sce<span class="sc">$</span>scDblFinder.class <span class="sc">==</span> <span class="st">&quot;doublet&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="normalization" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Normalization</h1>
<p>For normalization, the size factors <span
class="math inline">\(s_i\)</span> computed here are simply scaled
library sizes: <span class="math display">\[ N_i = \sum_g Y_{gi}
\]</span> <span class="math display">\[ s_i = N_i / \bar{N}_i
\]</span></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">logNormCounts</span>(sce)</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a><span class="co"># note we also returned log counts: see the additional logcounts assay.</span></span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>sce</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 17887 37092 
## metadata(1): scDblFinder.threshold
## assays(2): counts logcounts
## rownames(17887): KITL TMTC3 ... GM16012 GM21464
## rowData names(0):
## colnames(37092): r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA ... p1_TAACGCGCTCCT
##   p1_ATTCTTGTTCTT
## colData names(15): cluster sum ... scDblFinder.cxds_score sizeFactor
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="co"># you can extract size factors using</span></span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>sf <span class="ot">&lt;-</span> <span class="fu">librarySizeFactors</span>(sce)</span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a><span class="fu">mean</span>(sf) <span class="co"># equal to 1 due to scaling.</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span> <span class="fu">log</span>(<span class="fu">colSums</span>(<span class="fu">assays</span>(sce)<span class="sc">$</span>counts)), </span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>     <span class="at">y=</span>sf)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="feature-selection" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Feature selection</h1>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">library</span>(scran)</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">modelGeneVar</span>(sce)</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>fitRetina <span class="ot">&lt;-</span> <span class="fu">metadata</span>(dec)</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a><span class="fu">plot</span>(fitRetina<span class="sc">$</span>mean, fitRetina<span class="sc">$</span>var, </span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Variance of log-expression&quot;</span>)</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a><span class="fu">curve</span>(fitRetina<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="co"># get 10% highly variable genes</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>hvg <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec, <span class="at">prop=</span><span class="fl">0.1</span>)</span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a><span class="fu">head</span>(hvg)</span></code></pre></div>
<pre><code>## [1] &quot;RHO&quot;     &quot;CALM1&quot;   &quot;MEG3&quot;    &quot;RPGRIP1&quot; &quot;GNGT1&quot;   &quot;TRPM1&quot;</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># plot these </span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a><span class="fu">plot</span>(fitRetina<span class="sc">$</span>mean, fitRetina<span class="sc">$</span>var, </span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;darkseagreen3&quot;</span>)[(<span class="fu">names</span>(fitRetina<span class="sc">$</span>mean) <span class="sc">%in%</span> hvg)<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Variance of log-expression&quot;</span>)</span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a><span class="fu">curve</span>(fitRetina<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col=</span><span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Selected&quot;</span>, <span class="st">&quot;Not selected&quot;</span>), </span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkseagreen3&quot;</span>, <span class="st">&quot;orange&quot;</span>),</span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb76-11"><a href="#cb76-11" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&#39;n&#39;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
</div>
<div id="dimensionality-reduction" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Dimensionality
reduction</h1>
<p>Note that, below, we color the cells using the known, true cell type
label as defined in the metadata, to empirically evaluate the
dimensionality reduction. In reality, we don’t know this yet at this
stage.</p>
<div id="the-most-basic-dr" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> The most basic
DR</h2>
<p>Just by looking at the top two genes based on our feature selection
criterion, we can already see some separation according to the cell
type!</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">colData</span>(sce)<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">colData</span>(sce)<span class="sc">$</span>cluster)</span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">colData</span>(sce)<span class="sc">$</span>cluster</span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">bty=</span><span class="st">&#39;l&#39;</span>)</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">assays</span>(sce)<span class="sc">$</span>counts[hvg[<span class="dv">1</span>],],</span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">assays</span>(sce)<span class="sc">$</span>counts[hvg[<span class="dv">2</span>],],</span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">as.numeric</span>(cl),</span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Most informative gene&quot;</span>,</span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Second most informative gene&quot;</span>,</span>
<span id="cb77-11"><a href="#cb77-11" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Cells colored acc to cell type&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="linear-dimensionality-reduction-pca" class="section level2"
number="7.2">
<h2><span class="header-section-number">7.2</span> Linear dimensionality
reduction: PCA</h2>
<p>We are able to recover quite some structure. However, many cell
populations remain obscure, and the plot is overcrowded.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">runPCA</span>(sce, <span class="at">ncomponents=</span><span class="dv">30</span>, <span class="at">subset_row=</span>hvg)</span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a><span class="fu">plotPCA</span>(sce, <span class="at">colour_by =</span> <span class="st">&quot;cluster&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2911 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div id="pca-without-feature-selection" class="section level3"
number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> PCA without feature
selection</h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>sceNoFS <span class="ot">&lt;-</span> <span class="fu">runPCA</span>(sce, <span class="at">ncomponents=</span><span class="dv">30</span>, <span class="at">subset_row=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sce))</span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a><span class="fu">plotPCA</span>(sceNoFS, <span class="at">colour_by =</span> <span class="st">&quot;cluster&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2911 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">rm</span>(sceNoFS)</span></code></pre></div>
</div>
</div>
<div id="a-generalization-of-pca-for-exponential-family-distributions."
class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> A generalization of
PCA for exponential family distributions.</h2>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">library</span>(glmpca)</span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">211103</span>)</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>poipca <span class="ot">&lt;-</span> <span class="fu">glmpca</span>(<span class="fu">assays</span>(sce)<span class="sc">$</span>counts[hvg,],</span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>                 <span class="at">L=</span><span class="dv">2</span>, <span class="at">fam=</span><span class="st">&quot;poi&quot;</span>,</span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a>                 <span class="at">minibatch=</span><span class="st">&quot;stochastic&quot;</span>)</span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a><span class="fu">reducedDim</span>(sce, <span class="st">&quot;PoiPCA&quot;</span>) <span class="ot">&lt;-</span> poipca<span class="sc">$</span>factors</span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce, </span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>               <span class="at">dimred=</span><span class="st">&quot;PoiPCA&quot;</span>,</span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>               <span class="at">colour_by =</span> <span class="st">&quot;cluster&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2911 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="non-linear-dimensionality-reduction-umap"
class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Non-linear
dimensionality reduction: UMAP</h2>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>sce <span class="ot">&lt;-</span> <span class="fu">runUMAP</span>(sce, <span class="at">dimred =</span> <span class="st">&#39;PCA&#39;</span>, <span class="at">external_neighbors=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a><span class="fu">plotUMAP</span>(sce,</span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>         <span class="at">colour_by =</span> <span class="st">&quot;cluster&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2911 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
</div>
<div id="clustering" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Clustering</h1>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="co"># Build a shared nearest-neighbor graph from PCA space</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">buildSNNGraph</span>(sce, <span class="at">use.dimred =</span> <span class="st">&#39;PCA&#39;</span>)</span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a><span class="co"># Louvain clustering on the SNN graph, and add to sce</span></span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a><span class="fu">colData</span>(sce)<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(igraph<span class="sc">::</span><span class="fu">cluster_louvain</span>(g)<span class="sc">$</span>membership)</span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a><span class="co"># Visualization.</span></span>
<span id="cb87-7"><a href="#cb87-7" tabindex="-1"></a><span class="fu">plotUMAP</span>(sce, <span class="at">colour_by=</span><span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="singleCell_MacoskoWorkflow_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAnc2NSTkEtc2VxIHdvcmtmbG93OiBNYWNvc2tvIGV0IGFsLicKYXV0aG9yOiAiS29lbiBWYW4gZGVuIEJlcmdlIgpkYXRlOiAiMTEvMTYvMjAyMCIKb3V0cHV0OiAKICBodG1sX2RvY3VtZW50OgogICAgdG9jOiB0cnVlCiAgICB0b2NfZmxvYXQ6IHRydWUKLS0tCgojIEltcG9ydCBkYXRhCgpUaGUgYHNjUk5Bc2VxYCBwYWNrYWdlIHByb3ZpZGVzIGNvbnZlbmllbnQgYWNjZXNzIHRvIHNldmVyYWwgZGF0YXNldHMuIFNlZSB0aGUgW3BhY2thZ2UgQmlvY29uZHVjdG9yIHBhZ2VdKGh0dHA6Ly9iaW9jb25kdWN0b3Iub3JnL3BhY2thZ2VzL3JlbGVhc2UvZGF0YS9leHBlcmltZW50L2h0bWwvc2NSTkFzZXEuaHRtbCkgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgpgYGB7cn0KIyBpbnN0YWxsIEJpb2NNYW5hZ2VyIHBhY2thZ2UgaWYgbm90IGluc3RhbGxlZCB5ZXQuCiMgQmlvY01hbmFnZXIgaXMgdGhlIHBhY2thZ2UgaW5zdGFsbGVyIGZvciBCaW9jb25kdWN0b3Igc29mdHdhcmUuCmlmICghcmVxdWlyZU5hbWVzcGFjZSgiQmlvY01hbmFnZXIiLCBxdWlldGx5ID0gVFJVRSkpCiAgICBpbnN0YWxsLnBhY2thZ2VzKCJCaW9jTWFuYWdlciIpCgojIGluc3RhbGwgcGFja2FnZXMgaWYgbm90IHlldCBpbnN0YWxsZWQuCnBrZ3MgPC0gYygiU2luZ2xlQ2VsbEV4cGVyaW1lbnQiLCAiRHJvcGxldFV0aWxzIiwgInNjUk5Bc2VxIiwgInNjYXRlciIsICJzY3V0dGxlIiwgInNjcmFuIiwgIkJpb2NTaW5ndWxhciIsICJzY0RibEZpbmRlciIsICJnbG1wY2EiLCAidXdvdCIpCm5vdEluc3RhbGxlZCA8LSBwa2dzWyFwa2dzICVpbiUgaW5zdGFsbGVkLnBhY2thZ2VzKClbLDFdXQppZihsZW5ndGgobm90SW5zdGFsbGVkKSA+IDApewogIEJpb2NNYW5hZ2VyOjppbnN0YWxsKG5vdEluc3RhbGxlZCkKfQoKIyBDb2RlIGJlbG93IG1pZ2h0IGFzayB5b3UgdG8gY3JlYXRlIGFuIEV4cGVyaW1lbnRIdWIgZGlyZWN0b3J5LiAKIyBUeXBlICd5ZXMnIGFuZCBoaXQgRW50ZXIsIHRvIGFsbG93IHRoaXMuCnN1cHByZXNzUGFja2FnZVN0YXJ0dXBNZXNzYWdlcyhsaWJyYXJ5KHNjUk5Bc2VxKSkKc2NlIDwtIE1hY29za29SZXRpbmFEYXRhKCkKYGBgCgojIEEgYFNpbmdsZUNlbGxFeHBlcmltZW50YCBvYmplY3QKCgpgYGB7cn0Kc2NlCmBgYAoKIyMgQWNjZXNzaW5nIGRhdGEgZnJvbSBhIGBTaW5nbGVDZWxsRXhwZXJpbWVudGAgb2JqZWN0CgpQbGVhc2Ugc2VlIFtGaWd1cmUgNC4xIGluIE9TQ0FdKGh0dHA6Ly9iaW9jb25kdWN0b3Iub3JnL2Jvb2tzL3JlbGVhc2UvT1NDQS9kYXRhLWluZnJhc3RydWN0dXJlLmh0bWwpIGZvciBhbiBvdmVydmlldyBvZiBhIGBTaW5nbGVDZWxsRXhwZXJpbWVudGAgb2JqZWN0LgoKYGBge3J9CiMgRGF0YTogYXNzYXlzCmFzc2F5cyhzY2UpCmFzc2F5cyhzY2UpJGNvdW50c1sxOjUsIDE6NV0KCiMgRmVhdHVyZSBtZXRhZGF0YTogcm93RGF0YQpyb3dEYXRhKHNjZSkgIyBlbXB0eSBmb3Igbm93CgojIENlbGwgbWV0YWRhdGE6IGNvbERhdGEKY29sRGF0YShzY2UpCgojIFJlZHVjZWQgZGltZW5zaW9uczogcmVkdWNlZERpbXMKcmVkdWNlZERpbXMoc2NlKSAjIGVtcHR5IGZvciBub3cKYGBgCgojIyBDcmVhdGluZyBhIG5ldyBgU2luZ2xlQ2VsbEV4cGVyaW1lbnRgIG9iamVjdAoKYGBge3J9CnNjZU5ldyA8LSBTaW5nbGVDZWxsRXhwZXJpbWVudChhc3NheXMgPSBsaXN0KGNvdW50cyA9IGFzc2F5cyhzY2UpJGNvdW50cykpCnNjZU5ldwoKcm0oc2NlTmV3KQpgYGAKCiMjIFN0b3JpbmcgKG1ldGEpZGF0YSBpbiBhIGBTaW5nbGVDZWxsRXhwZXJpbWVudGAgb2JqZWN0CgpgYGB7cn0KZmFrZUdlbmVOYW1lcyA8LSBwYXN0ZTAoImdlbmUiLCAxOm5yb3coc2NlKSkKcm93RGF0YShzY2UpJGZha2VOYW1lIDwtIGZha2VHZW5lTmFtZXMKaGVhZChyb3dEYXRhKHNjZSkpCiMgUmVtb3ZlIGFnYWluIGJ5IHNldHRpbmcgdG8gTlVMTApyb3dEYXRhKHNjZSkkZmFrZU5hbWUgPC0gTlVMTAoKYXNzYXlzKHNjZSkkbG9nQ291bnRzIDwtIGxvZzFwKGFzc2F5cyhzY2UpJGNvdW50cykKYXNzYXlzKHNjZSkKYXNzYXlzKHNjZSkkbG9nQ291bnRzWzE6NSwgMTo1XQphc3NheXMoc2NlKSRsb2dDb3VudHMgPC0gTlVMTApgYGAKCiMgRmlsdGVyaW5nIG5vbi1pbmZvcm1hdGl2ZSBnZW5lcwoKYGBge3J9CmtlZXAgPC0gcm93U3Vtcyhhc3NheXMoc2NlKSRjb3VudHMgPiAwKSA+IDEwCnRhYmxlKGtlZXApCgpzY2UgPC0gc2NlW2tlZXAsXQpgYGAKCgojIFF1YWxpdHkgY29udHJvbAoKIyMgQ2FsY3VsYXRlIFFDIHZhcmlhYmxlcwoKYGBge3J9CmxpYnJhcnkoc2NhdGVyKQppcy5taXRvIDwtIGdyZXBsKCJeTVQtIiwgcm93bmFtZXMoc2NlKSkKc3VtKGlzLm1pdG8pICMgMjggbWl0b2Nob25kcmlhbCBnZW5lcwpkZiA8LSBwZXJDZWxsUUNNZXRyaWNzKHNjZSwgc3Vic2V0cz1saXN0KE1pdG89aXMubWl0bykpCiMjIGFkZCB0aGUgUUMgdmFyaWFibGVzIHRvIHNjZSBvYmplY3QKY29sRGF0YShzY2UpIDwtIGNiaW5kKGNvbERhdGEoc2NlKSwgZGYpCiMgdGhlIFFDIHZhcmlhYmxlcyBoYXZlIG5vdyBiZWVuIGFkZGVkIHRvIHRoZSBjb2xEYXRhIG9mIG91ciBTQ0Ugb2JqZWN0Lgpjb2xEYXRhKHNjZSkKYGBgCgojIyBFREEKCkhpZ2gtcXVhbGl0eSBjZWxscyBzaG91bGQgaGF2ZSBtYW55IGZlYXR1cmVzIGV4cHJlc3NlZCwgYW5kIGEgbG93IGNvbnRyaWJ1dGlvbiBvZiBtaXRvY2hvbmRyaWFsIGdlbmVzLiBIZXJlLCB3ZSBzZWUgdGhhdCBzZXZlcmFsIGNlbGxzIGhhdmUgYSB2ZXJ5IGxvdyBudW1iZXIgb2YgZXhwcmVzc2VkIGdlbmVzLCBhbmQgd2hlcmUgbW9zdCBvZiB0aGUgbW9sZWN1bGVzIGFyZSBkZXJpdmVkIGZyb20gbWl0b2Nob25kcmlhbCBnZW5lcy4gVGhpcyBpbmRpY2F0ZXMgbGlrZWx5IGRhbWFnZWQgY2VsbHMsIHByZXN1bWFibHkgYmVjYXVzZSBvZiBsb3NzIG9mIGN5dG9wbGFzbWljIFJOQSBmcm9tIHBlcmZvcmF0ZWQgY2VsbHMsIHNvIHdlJ2Qgd2FudCB0byByZW1vdmUgdGhlc2UgZm9yIHRoZSBkb3duc3RyZWFtIGFuYWx5c2lzLgoKYGBge3J9CiMgTnVtYmVyIG9mIGdlbmVzIHZzIGxpYnJhcnkgc2l6ZQpwbG90Q29sRGF0YShzY2UsIHggPSAic3VtIiwgeT0iZGV0ZWN0ZWQiLCBjb2xvdXJfYnk9ImNsdXN0ZXIiKSAKCiMgTWl0b2Nob25kcmlhbCBnZW5lcwpwbG90Q29sRGF0YShzY2UsIHggPSAiZGV0ZWN0ZWQiLCB5PSJzdWJzZXRzX01pdG9fcGVyY2VudCIpCmBgYAoKIyMgUUMgdXNpbmcgYWRhcHRpdmUgdGhyZXNob2xkcwoKQmVsb3csIHdlIHJlbW92ZSBjZWxscyB0aGF0IGFyZSBvdXRseWluZyB3aXRoIHJlc3BlY3QgdG8KCiAxLiBBIGxvdyBzZXF1ZW5jaW5nIGRlcHRoIChudW1iZXIgb2YgVU1Jcyk7CiAyLiBBIGxvdyBudW1iZXIgb2YgZ2VuZXMgZGV0ZWN0ZWQ7CiAzLiBBIGhpZ2ggcGVyY2VudGFnZSBvZiByZWFkcyBmcm9tIG1pdG9jaG9uZHJpYWwgZ2VuZXMuCiAKV2UgcmVtb3ZlIGEgdG90YWwgb2YgJDM0MjMkIGNlbGxzLCBtb3N0IG9mIHdoaWNoIGJlY2F1c2Ugb2YgYW4gb3V0bHlpbmdseSBoaWdoIHBlcmNlbnRhZ2Ugb2YgcmVhZHMgZnJvbSBtaXRvY2hvbmRyaWFsIGdlbmVzLgoKYGBge3J9Cmxvd0xpYiA8LSBpc091dGxpZXIoZGYkc3VtLCB0eXBlPSJsb3dlciIsIGxvZz1UUlVFKQpsb3dGZWF0dXJlcyA8LSBpc091dGxpZXIoZGYkZGV0ZWN0ZWQsIHR5cGU9Imxvd2VyIiwgbG9nPVRSVUUpCmhpZ2hNaXRvIDwtIGlzT3V0bGllcihkZiRzdWJzZXRzX01pdG9fcGVyY2VudCwgdHlwZT0iaGlnaGVyIikKCnRhYmxlKGxvd0xpYikKdGFibGUobG93RmVhdHVyZXMpCnRhYmxlKGhpZ2hNaXRvKQoKZGlzY2FyZENlbGxzIDwtIChsb3dMaWIgfCBsb3dGZWF0dXJlcyB8IGhpZ2hNaXRvKQp0YWJsZShkaXNjYXJkQ2VsbHMpCmNvbERhdGEoc2NlKSRkaXNjYXJkQ2VsbHMgPC0gZGlzY2FyZENlbGxzCgojIHZpc3VhbGl6ZSBjZWxscyB0byBiZSByZW1vdmVkCnBsb3RDb2xEYXRhKHNjZSwgeCA9ICJkZXRlY3RlZCIsIHk9InN1YnNldHNfTWl0b19wZXJjZW50IiwgY29sb3VyX2J5ID0gImRpc2NhcmRDZWxscyIpCgpgYGAKCgojIyBJZGVudGlmeWluZyBhbmQgcmVtb3ZpbmcgZW1wdHkgZHJvcGxldHMKCk5vdGUgdGhhdCB0aGUgcmVtb3ZhbCBvZiBjZWxscyB3aXRoIGxvdyBzZXF1ZW5jaW5nIGRlcHRoIHVzaW5nIHRoZSBhZGFwdGl2ZSB0aHJlc2hvbGQgcHJvY2VkdXJlIGFib3ZlIGlzIGEgd2F5IG9mIHJlbW92aW5nIGVtcHR5IGRyb3BsZXRzLiAKT3RoZXIgYXBwcm9hY2hlcyBhcmUgcG9zc2libGUsIGUuZy4sIHJlbW92aW5nIGNlbGxzIGJ5IHN0YXRpc3RpY2FsIHRlc3RpbmcgdXNpbmcgYGVtdHB5RHJvcHNgLgpUaGlzIGRvZXMgcmVxdWlyZSB1cyB0byBzcGVjaWZ5IGEgbG93ZXIgYm91bmQgb24gdGhlIHRvdGFsIG51bWJlciBvZiBVTUlzLCBiZWxvdyB3aGljaCBhbGwgY2VsbHMgYXJlIGNvbnNpZGVyZWQgdG8gY29ycmVzcG9uZCB0byBlbXB0eSBkcm9wbGV0cy4KVGhpcyBsb3dlciBib3VuZCBtYXkgbm90IGJlIHRyaXZpYWwgdG8gZGVyaXZlLCBidXQgdGhlIGBiYXJjb2RlUmFua3NgIGZ1bmN0aW9uIGNhbiBiZSB1c2VmdWwgdG8gaWRlbnRpZnkgYW4gZWxib3cva25lZSBwb2ludC4KCmBgYHtyfQpsaWJyYXJ5KERyb3BsZXRVdGlscykKYmNyYW5rIDwtIGJhcmNvZGVSYW5rcyhjb3VudHMoc2NlKSkKCiMgT25seSBzaG93aW5nIHVuaXF1ZSBwb2ludHMgZm9yIHBsb3R0aW5nIHNwZWVkLgp1bmlxIDwtICFkdXBsaWNhdGVkKGJjcmFuayRyYW5rKQpwbG90KGJjcmFuayRyYW5rW3VuaXFdLCBiY3JhbmskdG90YWxbdW5pcV0sIGxvZz0ieHkiLAogICAgeGxhYj0iUmFuayIsIHlsYWI9IlRvdGFsIFVNSSBjb3VudCIsIGNleC5sYWI9MS4yKQoKYWJsaW5lKGg9bWV0YWRhdGEoYmNyYW5rKSRpbmZsZWN0aW9uLCBjb2w9ImRhcmtncmVlbiIsIGx0eT0yKQphYmxpbmUoaD1tZXRhZGF0YShiY3JhbmspJGtuZWUsIGNvbD0iZG9kZ2VyYmx1ZSIsIGx0eT0yKQphYmxpbmUoaD0zNTAsIGNvbD0ib3JhbmdlIiwgbHR5PTIpICMgcGlja2VkIHZpc3VhbGx5IG15c2VsZgoKbGVnZW5kKCJ0b3ByaWdodCIsIGxlZ2VuZD1jKCJJbmZsZWN0aW9uIiwgIktuZWUiLCAiRW1waXJpY2FsIGtuZWUgcG9pbnQiKSwgCiAgICAgICAgY29sPWMoImRhcmtncmVlbiIsICJkb2RnZXJibHVlIiwgIm9yYW5nZSIpLCBsdHk9MiwgY2V4PTEuMikKCnNldC5zZWVkKDEwMCkKbGltaXQgPC0gMzUwICAgCmFsbC5vdXQgPC0gZW1wdHlEcm9wcyhjb3VudHMoc2NlKSwgbG93ZXI9bGltaXQsIHRlc3QuYW1iaWVudD1UUlVFKQojIHAtdmFsdWVzIGZvciBjZWxscyB3aXRoIHRvdGFsIFVNSSBjb3VudCB1bmRlciB0aGUgbG93ZXIgYm91bmQuCmhpc3QoYWxsLm91dCRQVmFsdWVbYWxsLm91dCRUb3RhbCA8PSBsaW1pdCAmIGFsbC5vdXQkVG90YWwgPiAwXSwKICAgIHhsYWI9IlAtdmFsdWUiLCBtYWluPSIiLCBjb2w9ImdyZXk4MCIpCgojIGJ1dCBub3RlIHRoYXQgaXQgd291bGQgcmVtb3ZlIGEgdmVyeSBoaWdoIG51bWJlciBvZiBjZWxscwpsZW5ndGgod2hpY2goYWxsLm91dCRGRFIgPD0gMC4wMDEpKQoKIyBzbyB3ZSBzdGljayB0byB0aGUgbW9yZSBsZW5pZW50IGFkYXB0aXZlIGZpbHRlcmluZyBzdHJhdGVneQojIHJlbW92ZSBjZWxscyBpZGVudGlmaWVkIHVzaW5nIGFkYXB0aXZlIHRocmVzaG9sZHMKc2NlIDwtIHNjZVssICFjb2xEYXRhKHNjZSkkZGlzY2FyZENlbGxzXQpgYGAKCiMjIElkZW50aWZ5aW5nIGFuZCByZW1vdmluZyBkb3VibGV0cwoKV2Ugd2lsbCB1c2UgW3NjRGJsRmluZGVyXShodHRwczovL2Jpb2NvbmR1Y3Rvci5vcmcvcGFja2FnZXMvMy4xNC9iaW9jL2h0bWwvc2NEYmxGaW5kZXIuaHRtbCkgdG8gZGV0ZWN0IGRvdWJsZXQgY2VsbHMuCgoKCmBgYHtyfQojIyBwZXJmb3JtIGRvdWJsZXQgZGV0ZWN0aW9uCmxpYnJhcnkoc2NEYmxGaW5kZXIpCnNldC5zZWVkKDIxMTEwMykKY29sRGF0YShzY2UpJGNlbGwuaWQgPC0gcm93bmFtZXMoY29sRGF0YShzY2UpKQpzYW1wbGVJRCA8LSB1bmxpc3QobGFwcGx5KHN0cnNwbGl0KGNvbERhdGEoc2NlKSRjZWxsLmlkLCBzcGxpdD0iXyIpLCAiW1siLCAxKSkKdGFibGUoc2FtcGxlSUQpCnNjZSA8LSBzY0RibEZpbmRlcihzY2UsCiAgICAgICAgICAgICAgICAgc2FtcGxlcyA9IGZhY3RvcihzYW1wbGVJRCkpCnRhYmxlKHNjZSRzY0RibEZpbmRlci5jbGFzcykKCgojIyB2aXN1YWxpemUgdGhlc2Ugc2NvcmVzCiMjIGV4cGxvcmUgZG91YmxldCBzY29yZSB3cnQgb3JpZ2luYWwgY2x1c3RlciBsYWJlbHMKYm94cGxvdChsb2cxcChzY2Ukc2NEYmxGaW5kZXIuc2NvcmUpIH4gZmFjdG9yKGNvbERhdGEoc2NlKSRjbHVzdGVyLCBleGNsdWRlPU5VTEwpKQoKdGFiIDwtIHRhYmxlKHNjZSRzY0RibEZpbmRlci5jbGFzcywgc2NlJGNsdXN0ZXIsIAogICAgICAgZXhjbHVkZT1OVUxMKQp0YWIKdCh0KHRhYikgLyBjb2xTdW1zKHRhYikpCgpiYXJwbG90KHQodCh0YWIpIC8gY29sU3Vtcyh0YWIpKVsyLF0sCiAgICAgICAgeGxhYiA9ICJDbHVzdGVyIiwgeWxhYiA9ICJGcmFjdGlvbiBvZiBkb3VibGV0cyIpCgojIHJlbW92ZSBkb3VibGV0cwpzY2UgPC0gc2NlWywhc2NlJHNjRGJsRmluZGVyLmNsYXNzID09ICJkb3VibGV0Il0KYGBgCgoKIyBOb3JtYWxpemF0aW9uCgpGb3Igbm9ybWFsaXphdGlvbiwgdGhlIHNpemUgZmFjdG9ycyAkc19pJCBjb21wdXRlZCBoZXJlIGFyZSBzaW1wbHkgc2NhbGVkIGxpYnJhcnkgc2l6ZXM6ClxbIE5faSA9IFxzdW1fZyBZX3tnaX0gXF0KXFsgc19pID0gTl9pIC8gXGJhcntOfV9pIFxdCgpgYGB7cn0Kc2NlIDwtIGxvZ05vcm1Db3VudHMoc2NlKQoKIyBub3RlIHdlIGFsc28gcmV0dXJuZWQgbG9nIGNvdW50czogc2VlIHRoZSBhZGRpdGlvbmFsIGxvZ2NvdW50cyBhc3NheS4Kc2NlCgojIHlvdSBjYW4gZXh0cmFjdCBzaXplIGZhY3RvcnMgdXNpbmcKc2YgPC0gbGlicmFyeVNpemVGYWN0b3JzKHNjZSkKbWVhbihzZikgIyBlcXVhbCB0byAxIGR1ZSB0byBzY2FsaW5nLgpwbG90KHg9IGxvZyhjb2xTdW1zKGFzc2F5cyhzY2UpJGNvdW50cykpLCAKICAgICB5PXNmKQpgYGAKCiMgRmVhdHVyZSBzZWxlY3Rpb24KCmBgYHtyfQpsaWJyYXJ5KHNjcmFuKQpkZWMgPC0gbW9kZWxHZW5lVmFyKHNjZSkKZml0UmV0aW5hIDwtIG1ldGFkYXRhKGRlYykKcGxvdChmaXRSZXRpbmEkbWVhbiwgZml0UmV0aW5hJHZhciwgCiAgICAgeGxhYj0iTWVhbiBvZiBsb2ctZXhwcmVzc2lvbiIsCiAgICB5bGFiPSJWYXJpYW5jZSBvZiBsb2ctZXhwcmVzc2lvbiIpCmN1cnZlKGZpdFJldGluYSR0cmVuZCh4KSwgY29sPSJkb2RnZXJibHVlIiwgYWRkPVRSVUUsIGx3ZD0yKQoKIyBnZXQgMTAlIGhpZ2hseSB2YXJpYWJsZSBnZW5lcwpodmcgPC0gZ2V0VG9wSFZHcyhkZWMsIHByb3A9MC4xKQpoZWFkKGh2ZykKCiMgcGxvdCB0aGVzZSAKcGxvdChmaXRSZXRpbmEkbWVhbiwgZml0UmV0aW5hJHZhciwgCiAgICAgY29sID0gYygib3JhbmdlIiwgImRhcmtzZWFncmVlbjMiKVsobmFtZXMoZml0UmV0aW5hJG1lYW4pICVpbiUgaHZnKSsxXSwKICAgICB4bGFiPSJNZWFuIG9mIGxvZy1leHByZXNzaW9uIiwKICAgIHlsYWI9IlZhcmlhbmNlIG9mIGxvZy1leHByZXNzaW9uIikKY3VydmUoZml0UmV0aW5hJHRyZW5kKHgpLCBjb2w9ImRvZGdlcmJsdWUiLCBhZGQ9VFJVRSwgbHdkPTIpCmxlZ2VuZCgidG9wbGVmdCIsIAogICAgICAgbGVnZW5kID0gYygiU2VsZWN0ZWQiLCAiTm90IHNlbGVjdGVkIiksIAogICAgICAgY29sID0gYygiZGFya3NlYWdyZWVuMyIsICJvcmFuZ2UiKSwKICAgICAgIHBjaCA9IDE2LAogICAgICAgYnR5PSduJykKYGBgCgojIERpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbgoKTm90ZSB0aGF0LCBiZWxvdywgd2UgY29sb3IgdGhlIGNlbGxzIHVzaW5nIHRoZSBrbm93biwgdHJ1ZSBjZWxsIHR5cGUgbGFiZWwgYXMgZGVmaW5lZCBpbiB0aGUgbWV0YWRhdGEsIHRvIGVtcGlyaWNhbGx5IGV2YWx1YXRlIHRoZSBkaW1lbnNpb25hbGl0eSByZWR1Y3Rpb24uIEluIHJlYWxpdHksIHdlIGRvbid0IGtub3cgdGhpcyB5ZXQgYXQgdGhpcyBzdGFnZS4KCiMjIFRoZSBtb3N0IGJhc2ljIERSCgpKdXN0IGJ5IGxvb2tpbmcgYXQgdGhlIHRvcCB0d28gZ2VuZXMgYmFzZWQgb24gb3VyIGZlYXR1cmUgc2VsZWN0aW9uIGNyaXRlcmlvbiwgd2UgY2FuIGFscmVhZHkgc2VlIHNvbWUgc2VwYXJhdGlvbiBhY2NvcmRpbmcgdG8gdGhlIGNlbGwgdHlwZSEKCmBgYHtyfQpjb2xEYXRhKHNjZSkkY2x1c3RlciA8LSBhcy5mYWN0b3IoY29sRGF0YShzY2UpJGNsdXN0ZXIpCmNsIDwtIGNvbERhdGEoc2NlKSRjbHVzdGVyCgpwYXIoYnR5PSdsJykKcGxvdCh4ID0gYXNzYXlzKHNjZSkkY291bnRzW2h2Z1sxXSxdLAogICAgIHkgPSBhc3NheXMoc2NlKSRjb3VudHNbaHZnWzJdLF0sCiAgICAgY29sID0gYXMubnVtZXJpYyhjbCksCiAgICAgcGNoID0gMTYsIGNleCA9IDEvMywKICAgICB4bGFiID0gIk1vc3QgaW5mb3JtYXRpdmUgZ2VuZSIsCiAgICAgeWxhYiA9ICJTZWNvbmQgbW9zdCBpbmZvcm1hdGl2ZSBnZW5lIiwKICAgICBtYWluID0gIkNlbGxzIGNvbG9yZWQgYWNjIHRvIGNlbGwgdHlwZSIpCmBgYAoKIyMgTGluZWFyIGRpbWVuc2lvbmFsaXR5IHJlZHVjdGlvbjogUENBCgpXZSBhcmUgYWJsZSB0byByZWNvdmVyIHF1aXRlIHNvbWUgc3RydWN0dXJlLiAKSG93ZXZlciwgbWFueSBjZWxsIHBvcHVsYXRpb25zIHJlbWFpbiBvYnNjdXJlLCBhbmQgdGhlIHBsb3QgaXMgb3ZlcmNyb3dkZWQuCgpgYGB7cn0Kc2V0LnNlZWQoMTIzNCkKc2NlIDwtIHJ1blBDQShzY2UsIG5jb21wb25lbnRzPTMwLCBzdWJzZXRfcm93PWh2ZykKcGxvdFBDQShzY2UsIGNvbG91cl9ieSA9ICJjbHVzdGVyIikKYGBgCgojIyMgUENBIHdpdGhvdXQgZmVhdHVyZSBzZWxlY3Rpb24KCmBgYHtyfQpzZXQuc2VlZCgxMjM0KQpzY2VOb0ZTIDwtIHJ1blBDQShzY2UsIG5jb21wb25lbnRzPTMwLCBzdWJzZXRfcm93PTE6bnJvdyhzY2UpKQpwbG90UENBKHNjZU5vRlMsIGNvbG91cl9ieSA9ICJjbHVzdGVyIikKcm0oc2NlTm9GUykKYGBgCgoKIyMgQSBnZW5lcmFsaXphdGlvbiBvZiBQQ0EgZm9yIGV4cG9uZW50aWFsIGZhbWlseSBkaXN0cmlidXRpb25zLgoKYGBge3IsIGV2YWw9VFJVRX0KbGlicmFyeShnbG1wY2EpCnNldC5zZWVkKDIxMTEwMykKcG9pcGNhIDwtIGdsbXBjYShhc3NheXMoc2NlKSRjb3VudHNbaHZnLF0sCiAgICAgICAgICAgICAgICAgTD0yLCBmYW09InBvaSIsCiAgICAgICAgICAgICAgICAgbWluaWJhdGNoPSJzdG9jaGFzdGljIikKcmVkdWNlZERpbShzY2UsICJQb2lQQ0EiKSA8LSBwb2lwY2EkZmFjdG9ycwpwbG90UmVkdWNlZERpbShzY2UsIAogICAgICAgICAgICAgICBkaW1yZWQ9IlBvaVBDQSIsCiAgICAgICAgICAgICAgIGNvbG91cl9ieSA9ICJjbHVzdGVyIikKYGBgCgoKCiMjIE5vbi1saW5lYXIgZGltZW5zaW9uYWxpdHkgcmVkdWN0aW9uOiBVTUFQCgpgYGB7cn0Kc2NlIDwtIHJ1blVNQVAoc2NlLCBkaW1yZWQgPSAnUENBJywgZXh0ZXJuYWxfbmVpZ2hib3JzPVRSVUUpCnBsb3RVTUFQKHNjZSwKICAgICAgICAgY29sb3VyX2J5ID0gImNsdXN0ZXIiKQpgYGAKCiMgQ2x1c3RlcmluZwoKYGBge3J9CiMgQnVpbGQgYSBzaGFyZWQgbmVhcmVzdC1uZWlnaGJvciBncmFwaCBmcm9tIFBDQSBzcGFjZQpnIDwtIGJ1aWxkU05OR3JhcGgoc2NlLCB1c2UuZGltcmVkID0gJ1BDQScpCiMgTG91dmFpbiBjbHVzdGVyaW5nIG9uIHRoZSBTTk4gZ3JhcGgsIGFuZCBhZGQgdG8gc2NlCmNvbERhdGEoc2NlKSRsYWJlbCA8LSBmYWN0b3IoaWdyYXBoOjpjbHVzdGVyX2xvdXZhaW4oZykkbWVtYmVyc2hpcCkKCiMgVmlzdWFsaXphdGlvbi4KcGxvdFVNQVAoc2NlLCBjb2xvdXJfYnk9ImxhYmVsIikKYGBgCg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("singleCell_MacoskoWorkflow.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
